# gbs-tools

CopyBarcodes performs pre-alignment processing of FASTQ files representing paired-end GBS reads (e.g., those generated by Illumina machines).  The two goals are to identify, and optionally correct, sequencing errors in the barcode/overhang region of the forward reads, as well as add correct(ed) barcodes to the resepective reverse reads.

In all cases, an initial verification step is performed, using a prefix-tree to check that the beginning of each read in the forward-read FASTQ file contains one of the barcodes in the supplied barcode file, and that this barcode is immediately followed by one of the two possible overhang sequences that would be genereated by the ApeK1 restriction enzyme.

If only forward and reverse read FASTQ files, plus a barcode file, are passed, mismatches are deleted from the output forward- and reverse-read FASTQ files, which are written to disc as .gz files.

If the "fuzzy" argument is passed, fuzzy-matching is performed in cases of mismatches, and if a unique barcode can be identified by changing no more than one low-quality (i.e., lower than quality score of F), these are then added and written to the output files as well.

If, instead, "retain" is passed, mismatches are not removed from either the forward=read file, and are copied as-is to the reverse-read zipped FASTQ file.

Example usage:

```bash
export forwardReads = "191016_AHLKHHDMXX/Box-1_S79_L001_R1_001.fastq.gz"
export reverseReads = "191016_AHLKHHDMXX/Box-1_S79_L001_R2_001.fastq.gz"
export barcodes = "191016_AHLKHHDMXX/GBS-ApeKI-1-96_barcodes.txt"

java -cp CopyBarcodes.jar CopyBarcodes $forwardReads $reverseReads $barcodes [fuzzy|retain]
```
N.B. "fuzzy" and "retain" are mutually-exclusive options.

Benchmarking was performed on a MacBook Pro with a 3.3 GHz Intel Core i7 CPU and 16 GB of 2133 MHz LPDDR3 RAM.  The forward-read file was 28.64 GB, and the reverse-read file was 29.74 GB.

retain: ~4hrs

fuzzy: 450 minutes (wrote 391500631, skipped 9395774, fuzzed 3211739)

nothing: ~7.5 hrs
